
= Invalid execution results =
| ------------------------------------------------ |
|    Thread 1     |            Thread 2            |
| ------------------------------------------------ |
| add(a): true    |                                |
| ------------------------------------------------ |
| remove(a): true | remove(a): false               |
|                 | setCount(a, 0, 1): false [0,1] |
| ------------------------------------------------ |

---
All operations above the horizontal line | ----- | happen before those below the line
---
Values in "[..]" brackets indicate the number of completed operations
in each of the parallel threads seen at the beginning of the current operation
---

The following interleaving leads to the error:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                        Thread 1                                                         |                                                         Thread 2                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| add(a): true                                                                                                            |                                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| remove(a): true                                                                                                         |                                                                                                                           |
|   remove(a): true at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                |                                                                                                                           |
|     remove(a,1): 1 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                 |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276) |                                                                                                                           |
|       get(): 1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                        |                                                                                                                           |
|       compareAndSet(1,0): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:284)                        |                                                                                                                           |
|       remove(a,AtomicInteger@1): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:288)                 |                                                                                                                           |
|         replaceNode(a,null,AtomicInteger@1): AtomicInteger@1 at ConcurrentHashMap.remove(ConcurrentHashMap.java:1552)   |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                            |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                       |                                                                                                                           |
|           MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                    |                                                                                                                           |
|           switch                                                                                                        |                                                                                                                           |
|                                                                                                                         | remove(a): false                                                                                                          |
|                                                                                                                         | setCount(a, 0, 1): false                                                                                                  |
|                                                                                                                         |   setCount(a,0,1): false at ConcurrentHashMultisetTest.setCount(ConcurrentHashMultisetTest.kt:44)                         |
|                                                                                                                         |     safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:408)   |
|                                                                                                                         |     get(): 0 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:419)                                          |
|                                                                                                                         |     <init>(1) at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:427)                                         |
|                                                                                                                         |     putIfAbsent(a,AtomicInteger@2): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:428)   |
|                                                                                                                         |     replace(a,AtomicInteger@1,AtomicInteger@2): false at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:429) |
|                                                                                                                         |       replaceNode(a,AtomicInteger@2,AtomicInteger@1): null at ConcurrentHashMap.replace(ConcurrentHashMap.java:1563)      |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                                |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                           |
|                                                                                                                         |         MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                        |
|                                                                                                                         |         switch (reason: lock is already acquired)                                                                         |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                       |                                                                                                                           |
|           setTabAt(Node[]@1,1,null) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1140)                       |                                                                                                                           |
|           MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                     |                                                                                                                           |
|           addCount(-1,-1) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1173)                                 |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                             |
|                                                                                                                         |         MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                             |
|                                                                                                                         |   result: false                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Detailed trace:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                        Thread 1                                                         |                                                         Thread 2                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| add(a): true                                                                                                            |                                                                                                                           |
|   add(a): true at ConcurrentHashMultisetTest.add(ConcurrentHashMultisetTest.kt:19)                                      |                                                                                                                           |
|     add(a,1): 0 at AbstractMultiset.add(AbstractMultiset.java:62)                                                       |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): null at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:211)               |                                                                                                                           |
|         get(a): null at Maps.safeGet(Maps.java:3517)                                                                    |                                                                                                                           |
|           table.READ: null at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                         |                                                                                                                           |
|       <init>(1) at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:213)                                          |                                                                                                                           |
|       putIfAbsent(a,AtomicInteger@1): null at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:213)               |                                                                                                                           |
|         putVal(a,AtomicInteger@1,true): null at ConcurrentHashMap.putIfAbsent(ConcurrentHashMap.java:1541)              |                                                                                                                           |
|           table.READ: null at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1014)                                     |                                                                                                                           |
|           initTable(): Node[]@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1017)                                |                                                                                                                           |
|             table.READ: null at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2293)                                |                                                                                                                           |
|             sizeCtl.READ: 0 at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2294)                                 |                                                                                                                           |
|             compareAndSetInt(0,-1): true at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2296)                    |                                                                                                                           |
|             table.READ: null at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2298)                                |                                                                                                                           |
|             table.WRITE(Node[]@1) at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2302)                           |                                                                                                                           |
|             sizeCtl.WRITE(12) at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2306)                               |                                                                                                                           |
|           tabAt(Node[]@1,1): null at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1018)                              |                                                                                                                           |
|             getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                          |                                                                                                                           |
|           casTabAt(Node[]@1,1,null,Node@1): true at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1019)               |                                                                                                                           |
|             compareAndSetReference(null,Node@1): true at ConcurrentHashMap.casTabAt(ConcurrentHashMap.java:765)         |                                                                                                                           |
|           addCount(1,0) at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1075)                                        |                                                                                                                           |
|             counterCells.READ: null at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                          |                                                                                                                           |
|             baseCount.READ: 0 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                                |                                                                                                                           |
|             compareAndSetLong(0,1): true at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2327)                     |                                                                                                                           |
|             sizeCtl.READ: 12 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2343)                                 |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| remove(a): true                                                                                                         |                                                                                                                           |
|   remove(a): true at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                |                                                                                                                           |
|     remove(a,1): 1 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                 |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276) |                                                                                                                           |
|         get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                         |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                     |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|       get(): 1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                        |                                                                                                                           |
|       compareAndSet(1,0): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:284)                        |                                                                                                                           |
|       remove(a,AtomicInteger@1): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:288)                 |                                                                                                                           |
|         replaceNode(a,null,AtomicInteger@1): AtomicInteger@1 at ConcurrentHashMap.remove(ConcurrentHashMap.java:1552)   |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                            |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                       |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|           MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                    |                                                                                                                           |
|           switch                                                                                                        |                                                                                                                           |
|                                                                                                                         | remove(a): false                                                                                                          |
|                                                                                                                         |   remove(a): false at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                 |
|                                                                                                                         |     remove(a,1): 0 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                   |
|                                                                                                                         |       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276)   |
|                                                                                                                         |         get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                           |
|                                                                                                                         |           table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                       |
|                                                                                                                         |           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                  |
|                                                                                                                         |             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                          |
|                                                                                                                         |       get(): 0 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                          |
|                                                                                                                         |   result: false                                                                                                           |
|                                                                                                                         | setCount(a, 0, 1): false                                                                                                  |
|                                                                                                                         |   setCount(a,0,1): false at ConcurrentHashMultisetTest.setCount(ConcurrentHashMultisetTest.kt:44)                         |
|                                                                                                                         |     safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:408)   |
|                                                                                                                         |       get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                             |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                    |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |     get(): 0 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:419)                                          |
|                                                                                                                         |     <init>(1) at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:427)                                         |
|                                                                                                                         |     putIfAbsent(a,AtomicInteger@2): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:428)   |
|                                                                                                                         |       putVal(a,AtomicInteger@2,true): AtomicInteger@1 at ConcurrentHashMap.putIfAbsent(ConcurrentHashMap.java:1541)       |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1014)                                     |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1018)                                |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |     replace(a,AtomicInteger@1,AtomicInteger@2): false at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:429) |
|                                                                                                                         |       replaceNode(a,AtomicInteger@2,AtomicInteger@1): null at ConcurrentHashMap.replace(ConcurrentHashMap.java:1563)      |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                                |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                           |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |         MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                        |
|                                                                                                                         |         switch (reason: lock is already acquired)                                                                         |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                       |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|           setTabAt(Node[]@1,1,null) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1140)                       |                                                                                                                           |
|             putReferenceRelease(null) at ConcurrentHashMap.setTabAt(ConcurrentHashMap.java:769)                         |                                                                                                                           |
|           MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                     |                                                                                                                           |
|           addCount(-1,-1) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1173)                                 |                                                                                                                           |
|             counterCells.READ: null at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                          |                                                                                                                           |
|             baseCount.READ: 1 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                                |                                                                                                                           |
|             compareAndSetLong(1,0): true at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2327)                     |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                             |
|                                                                                                                         |           getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                              |
|                                                                                                                         |         MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                             |
|                                                                                                                         |           getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                              |
|                                                                                                                         |   result: false                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

org.jetbrains.kotlinx.lincheck.LincheckAssertionError: 
= Invalid execution results =
| ------------------------------------------------ |
|    Thread 1     |            Thread 2            |
| ------------------------------------------------ |
| add(a): true    |                                |
| ------------------------------------------------ |
| remove(a): true | remove(a): false               |
|                 | setCount(a, 0, 1): false [0,1] |
| ------------------------------------------------ |

---
All operations above the horizontal line | ----- | happen before those below the line
---
Values in "[..]" brackets indicate the number of completed operations
in each of the parallel threads seen at the beginning of the current operation
---

The following interleaving leads to the error:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                        Thread 1                                                         |                                                         Thread 2                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| add(a): true                                                                                                            |                                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| remove(a): true                                                                                                         |                                                                                                                           |
|   remove(a): true at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                |                                                                                                                           |
|     remove(a,1): 1 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                 |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276) |                                                                                                                           |
|       get(): 1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                        |                                                                                                                           |
|       compareAndSet(1,0): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:284)                        |                                                                                                                           |
|       remove(a,AtomicInteger@1): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:288)                 |                                                                                                                           |
|         replaceNode(a,null,AtomicInteger@1): AtomicInteger@1 at ConcurrentHashMap.remove(ConcurrentHashMap.java:1552)   |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                            |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                       |                                                                                                                           |
|           MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                    |                                                                                                                           |
|           switch                                                                                                        |                                                                                                                           |
|                                                                                                                         | remove(a): false                                                                                                          |
|                                                                                                                         | setCount(a, 0, 1): false                                                                                                  |
|                                                                                                                         |   setCount(a,0,1): false at ConcurrentHashMultisetTest.setCount(ConcurrentHashMultisetTest.kt:44)                         |
|                                                                                                                         |     safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:408)   |
|                                                                                                                         |     get(): 0 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:419)                                          |
|                                                                                                                         |     <init>(1) at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:427)                                         |
|                                                                                                                         |     putIfAbsent(a,AtomicInteger@2): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:428)   |
|                                                                                                                         |     replace(a,AtomicInteger@1,AtomicInteger@2): false at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:429) |
|                                                                                                                         |       replaceNode(a,AtomicInteger@2,AtomicInteger@1): null at ConcurrentHashMap.replace(ConcurrentHashMap.java:1563)      |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                                |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                           |
|                                                                                                                         |         MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                        |
|                                                                                                                         |         switch (reason: lock is already acquired)                                                                         |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                       |                                                                                                                           |
|           setTabAt(Node[]@1,1,null) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1140)                       |                                                                                                                           |
|           MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                     |                                                                                                                           |
|           addCount(-1,-1) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1173)                                 |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                             |
|                                                                                                                         |         MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                             |
|                                                                                                                         |   result: false                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

Detailed trace:
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                                                        Thread 1                                                         |                                                         Thread 2                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| add(a): true                                                                                                            |                                                                                                                           |
|   add(a): true at ConcurrentHashMultisetTest.add(ConcurrentHashMultisetTest.kt:19)                                      |                                                                                                                           |
|     add(a,1): 0 at AbstractMultiset.add(AbstractMultiset.java:62)                                                       |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): null at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:211)               |                                                                                                                           |
|         get(a): null at Maps.safeGet(Maps.java:3517)                                                                    |                                                                                                                           |
|           table.READ: null at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                         |                                                                                                                           |
|       <init>(1) at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:213)                                          |                                                                                                                           |
|       putIfAbsent(a,AtomicInteger@1): null at ConcurrentHashMultiset.add(ConcurrentHashMultiset.java:213)               |                                                                                                                           |
|         putVal(a,AtomicInteger@1,true): null at ConcurrentHashMap.putIfAbsent(ConcurrentHashMap.java:1541)              |                                                                                                                           |
|           table.READ: null at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1014)                                     |                                                                                                                           |
|           initTable(): Node[]@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1017)                                |                                                                                                                           |
|             table.READ: null at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2293)                                |                                                                                                                           |
|             sizeCtl.READ: 0 at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2294)                                 |                                                                                                                           |
|             compareAndSetInt(0,-1): true at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2296)                    |                                                                                                                           |
|             table.READ: null at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2298)                                |                                                                                                                           |
|             table.WRITE(Node[]@1) at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2302)                           |                                                                                                                           |
|             sizeCtl.WRITE(12) at ConcurrentHashMap.initTable(ConcurrentHashMap.java:2306)                               |                                                                                                                           |
|           tabAt(Node[]@1,1): null at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1018)                              |                                                                                                                           |
|             getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                          |                                                                                                                           |
|           casTabAt(Node[]@1,1,null,Node@1): true at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1019)               |                                                                                                                           |
|             compareAndSetReference(null,Node@1): true at ConcurrentHashMap.casTabAt(ConcurrentHashMap.java:765)         |                                                                                                                           |
|           addCount(1,0) at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1075)                                        |                                                                                                                           |
|             counterCells.READ: null at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                          |                                                                                                                           |
|             baseCount.READ: 0 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                                |                                                                                                                           |
|             compareAndSetLong(0,1): true at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2327)                     |                                                                                                                           |
|             sizeCtl.READ: 12 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2343)                                 |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| remove(a): true                                                                                                         |                                                                                                                           |
|   remove(a): true at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                |                                                                                                                           |
|     remove(a,1): 1 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                 |                                                                                                                           |
|       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276) |                                                                                                                           |
|         get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                         |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                     |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|       get(): 1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                        |                                                                                                                           |
|       compareAndSet(1,0): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:284)                        |                                                                                                                           |
|       remove(a,AtomicInteger@1): true at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:288)                 |                                                                                                                           |
|         replaceNode(a,null,AtomicInteger@1): AtomicInteger@1 at ConcurrentHashMap.remove(ConcurrentHashMap.java:1552)   |                                                                                                                           |
|           table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                            |                                                                                                                           |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                       |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|           MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                    |                                                                                                                           |
|           switch                                                                                                        |                                                                                                                           |
|                                                                                                                         | remove(a): false                                                                                                          |
|                                                                                                                         |   remove(a): false at ConcurrentHashMultisetTest.remove(ConcurrentHashMultisetTest.kt:24)                                 |
|                                                                                                                         |     remove(a,1): 0 at AbstractMultiset.remove(AbstractMultiset.java:75)                                                   |
|                                                                                                                         |       safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:276)   |
|                                                                                                                         |         get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                           |
|                                                                                                                         |           table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                       |
|                                                                                                                         |           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                  |
|                                                                                                                         |             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                          |
|                                                                                                                         |       get(): 0 at ConcurrentHashMultiset.remove(ConcurrentHashMultiset.java:281)                                          |
|                                                                                                                         |   result: false                                                                                                           |
|                                                                                                                         | setCount(a, 0, 1): false                                                                                                  |
|                                                                                                                         |   setCount(a,0,1): false at ConcurrentHashMultisetTest.setCount(ConcurrentHashMultisetTest.kt:44)                         |
|                                                                                                                         |     safeGet(ConcurrentHashMap@1,a): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:408)   |
|                                                                                                                         |       get(a): AtomicInteger@1 at Maps.safeGet(Maps.java:3517)                                                             |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:937)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.get(ConcurrentHashMap.java:938)                                    |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |     get(): 0 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:419)                                          |
|                                                                                                                         |     <init>(1) at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:427)                                         |
|                                                                                                                         |     putIfAbsent(a,AtomicInteger@2): AtomicInteger@1 at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:428)   |
|                                                                                                                         |       putVal(a,AtomicInteger@2,true): AtomicInteger@1 at ConcurrentHashMap.putIfAbsent(ConcurrentHashMap.java:1541)       |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1014)                                     |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.putVal(ConcurrentHashMap.java:1018)                                |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |     replace(a,AtomicInteger@1,AtomicInteger@2): false at ConcurrentHashMultiset.setCount(ConcurrentHashMultiset.java:429) |
|                                                                                                                         |       replaceNode(a,AtomicInteger@2,AtomicInteger@1): null at ConcurrentHashMap.replace(ConcurrentHashMap.java:1563)      |
|                                                                                                                         |         table.READ: Node[]@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1112)                                |
|                                                                                                                         |         tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                           |
|                                                                                                                         |           getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                            |
|                                                                                                                         |         MONITORENTER at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1122)                                        |
|                                                                                                                         |         switch (reason: lock is already acquired)                                                                         |
|           tabAt(Node[]@1,1): Node@1 at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                       |                                                                                                                           |
|             getReferenceAcquire(): Node@1 at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                        |                                                                                                                           |
|           setTabAt(Node[]@1,1,null) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1140)                       |                                                                                                                           |
|             putReferenceRelease(null) at ConcurrentHashMap.setTabAt(ConcurrentHashMap.java:769)                         |                                                                                                                           |
|           MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                     |                                                                                                                           |
|           addCount(-1,-1) at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1173)                                 |                                                                                                                           |
|             counterCells.READ: null at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                          |                                                                                                                           |
|             baseCount.READ: 1 at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2326)                                |                                                                                                                           |
|             compareAndSetLong(1,0): true at ConcurrentHashMap.addCount(ConcurrentHashMap.java:2327)                     |                                                                                                                           |
|   result: true                                                                                                          |                                                                                                                           |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1123)                             |
|                                                                                                                         |           getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                              |
|                                                                                                                         |         MONITOREXIT at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1169)                                         |
|                                                                                                                         |         tabAt(Node[]@1,1): null at ConcurrentHashMap.replaceNode(ConcurrentHashMap.java:1115)                             |
|                                                                                                                         |           getReferenceAcquire(): null at ConcurrentHashMap.tabAt(ConcurrentHashMap.java:760)                              |
|                                                                                                                         |   result: false                                                                                                           |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

	at org.jetbrains.kotlinx.lincheck.LinChecker.check(LinChecker.kt:43)
	at org.jetbrains.kotlinx.lincheck.LinChecker$Companion.check(LinChecker.kt:149)
	at org.jetbrains.kotlinx.lincheck.LinCheckerKt.check(LinChecker.kt:164)
	at org.jetbrains.kotlinx.lincheck.LinCheckerKt.check(LinChecker.kt:173)
	at agronaTests.ConcurrentHashMultisetTest.modelTest(ConcurrentHashMultisetTest.kt:49)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.runTestClass(JUnitTestClassExecutor.java:112)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:58)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:40)
	at org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor.processTestClass(AbstractJUnitTestClassProcessor.java:60)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:52)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)
	at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)
	at jdk.proxy1/jdk.proxy1.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker$2.run(TestWorker.java:176)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.executeAndMaintainThreadName(TestWorker.java:129)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:100)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:60)
	at org.gradle.process.internal.worker.child.ActionExecutionWorker.execute(ActionExecutionWorker.java:56)
	at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:113)
	at org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:65)
	at worker.org.gradle.process.internal.worker.GradleWorkerMain.run(GradleWorkerMain.java:69)
	at worker.org.gradle.process.internal.worker.GradleWorkerMain.main(GradleWorkerMain.java:74)

